<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mis 15 Años - Anthonella Afanador</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

<!-- FontAwesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
    /* Configuración de Fuentes y Colores Base */
    :root {
        --bg-pink: #fcedee; /* Nuevo fondo rosa claro */
        --primary-color: #d4a5a5; /* Rosa Viejo */
        --secondary-color: #9e7f7f;
        --gold: #c5a059;
        --text-dark: #4a4a4a;
        --red-accent: #c62828; /* Nuevo acento rojo */
    }

    body {
        font-family: 'Montserrat', sans-serif;
        background-color: var(--bg-pink); /* Aplicando el nuevo fondo */
        color: var(--text-dark);
        overflow-x: hidden;
    }

    h1, h2, .script-font {
        font-family: 'Great Vibes', cursive;
    }

    h3, .serif-font {
        font-family: 'Playfair Display', serif;
    }

    /* Decoración de Esquinas con Flores Rojas */
    .corner-decoration {
        position: fixed;
        width: 180px; /* Tamaño de las flores en esquinas */
        height: 180px;
        z-index: 10; /* Por encima del fondo, debajo del contenido interactivo */
        pointer-events: none; /* Para que los clicks traspasen */
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        opacity: 0.9;
        /* Usamos una imagen de PNG transparente de rosas rojas */
        background-image: url('https://cdn.pixabay.com/photo/2017/10/12/16/57/rose-2845203_1280.png');
    }

    .corner-tl {
        top: -20px;
        left: -20px;
        transform: rotate(0deg);
    }

    .corner-tr {
        top: -20px;
        right: -20px;
        transform: rotate(90deg);
    }

    .corner-bl {
        bottom: -20px;
        left: -20px;
        transform: rotate(-90deg);
    }

    .corner-br {
        bottom: -20px;
        right: -20px;
        transform: rotate(180deg);
    }

    /* Ajuste de partículas para que combinen con el rosa */
    .particle {
        position: fixed;
        border-radius: 50%;
        /* Color de partícula ajustado a un rosa más vibrante/rojo claro */
        background: rgba(255, 150, 160, 0.4); 
        pointer-events: none;
        z-index: 5;
        animation: floatUp linear infinite;
    }

    @keyframes floatUp {
        0% { transform: translateY(100vh) scale(0); opacity: 0; }
        50% { opacity: 0.6; }
        100% { transform: translateY(-10vh) scale(1); opacity: 0; }
    }

    /* Botón de Música Flotante */
    .music-control {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: var(--gold);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        cursor: pointer;
        z-index: 1000;
        transition: transform 0.3s;
    }
    
    .music-control:hover { transform: scale(1.1); }
    .music-rotating { animation: spin 4s linear infinite; }

    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* Estilos de la Galería */
    .gallery-item {
        overflow: hidden;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    .gallery-item:hover {
        transform: translateY(-5px);
    }
    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    .gallery-item:hover img {
        transform: scale(1.05);
    }

    /* Separador dorado */
    .divider-custom {
        height: 2px;
        width: 100px;
        background: linear-gradient(90deg, transparent, var(--gold), transparent);
        margin: 2rem auto;
    }

    /* Smooth Reveal Animation Class */
    .reveal {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.8s ease-out;
    }
    .reveal.active {
        opacity: 1;
        transform: translateY(0);
    }

    /* Cuenta Regresiva */
    .countdown-box {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(197, 160, 89, 0.4);
    }

    /* Ajustes para secciones con fondo blanco para que se note el rosa de fondo */
    section.bg-white {
        background-color: rgba(255, 255, 255, 0.9) !important;
        backdrop-filter: blur(2px);
         border-radius: 20px;
         margin-top: 20px;
         margin-bottom: 20px;
         box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    
    /* Ajuste específico para la sección de cuenta regresiva para que se integre */
    #section-countdown {
         background-color: transparent;
    }

</style>


</head>
<body class="antialiased">

<!-- Elementos decorativos de las esquinas -->
<div class="corner-decoration corner-tl"></div>
<div class="corner-decoration corner-tr"></div>
<div class="corner-decoration corner-bl"></div>
<div class="corner-decoration corner-br"></div>

<!-- Audio Player (Oculto) -->
<audio id="bgMusic" loop>
    <!-- Enlace de Google Drive convertido para streaming de audio -->
    <source src="https://drive.google.com/uc?export=download&id=1QyvmFIa6xM79c-KWrHqq4y2vyJnOOm4X" type="audio/mpeg">
</audio>

<!-- Botón de Control de Música -->
<div class="music-control" onclick="toggleMusic()">
    <i id="musicIcon" class="fas fa-play"></i>
</div>

<!-- Contenedor de Partículas -->
<div id="particles-container"></div>

<!-- HERO SECTION -->
<header class="relative h-screen flex items-center justify-center overflow-hidden">
    <!-- Imagen de Fondo con Overlay -->
    <div class="absolute inset-0 z-0">
        <img src="https://images.unsplash.com/photo-1513151233558-d860c5398176?q=80&w=2070&auto=format&fit=crop" 
             class="w-full h-full object-cover brightness-50" 
             alt="Fondo de fiesta de 15 años">
        <div class="absolute inset-0 bg-gradient-to-b from-red-900/30 via-transparent to-pink-100/80"></div>
    </div>

    <div class="relative z-20 text-center text-white px-4 animate__animated animate__fadeInDown">
        <p class="text-xl md:text-2xl mb-2 tracking-widest uppercase drop-shadow-md">Mi familia y yo estamos complacidos de invitarte a una noche muy especial con motivo de mis </p>
        <h1 class="text-7xl md:text-9xl mb-4 text-[#ffe4e1] drop-shadow-lg">15 Años</h1>
        <!-- Nombre de la Quinceañera con estilo de caligrafía y capitalización corregida -->
        <h2 class="text-4xl md:text-6xl mb-6 text-[#ffd700] drop-shadow-md tracking-wider">Anthonella Afanador</h2>
        <div class="divider-custom bg-white"></div>
        <p class="text-xl md:text-2xl mt-4 font-light drop-shadow-md">Una noche mágica llena de sueños</p>
        
        <div class="mt-12 animate__animated animate__bounceIn animate__delay-1s">
            <i class="fas fa-chevron-down text-3xl animate-bounce"></i>
        </div>
    </div>
</header>

<!-- FRASE / INTRO -->
<section class="py-20 px-6 max-w-4xl mx-auto text-center reveal relative z-20">
    <i class="fas fa-quote-left text-3xl text-[#c62828] mb-4"></i>
    <p class="text-lg md:text-xl text-gray-700 leading-relaxed serif-font italic font-medium">
        "Hay momentos en la vida que imaginamos, soñamos y esperamos. 
        Uno de esos momentos ha llegado y quiero compartirlo con las personas 
        que hacen mi vida más especial."
    </p>
    <i class="fas fa-quote-right text-3xl text-[#c62828] mt-4"></i>
    <div class="divider-custom"></div>
    <p class="text-gray-600 uppercase tracking-widest text-sm">Con la bendición de mis padres</p>
    <p class="text-xl mt-2 font-semibold text-[#9e7f7f]">Andres & Priscilla</p>
</section>

<!-- CUENTA REGRESIVA -->
<section id="section-countdown" class="py-16 reveal relative z-20">
    <div class="container mx-auto px-4 text-center">
        <h2 class="text-4xl md:text-5xl text-[#c62828] mb-10 script-font">Falta muy poco</h2>
        
        <div class="flex flex-wrap justify-center gap-4 md:gap-8" id="countdown">
            <!-- Los elementos se generan con JS -->
            <div class="countdown-box w-20 h-24 md:w-32 md:h-36 flex flex-col items-center justify-center rounded-lg shadow-sm">
                <span id="days" class="text-3xl md:text-5xl font-bold text-[#c62828]">00</span>
                <span class="text-xs md:text-sm uppercase text-gray-600 mt-1 font-bold">Días</span>
            </div>
            <div class="countdown-box w-20 h-24 md:w-32 md:h-36 flex flex-col items-center justify-center rounded-lg shadow-sm">
                <span id="hours" class="text-3xl md:text-5xl font-bold text-[#c62828]">00</span>
                <span class="text-xs md:text-sm uppercase text-gray-600 mt-1 font-bold">Hs</span>
            </div>
            <div class="countdown-box w-20 h-24 md:w-32 md:h-36 flex flex-col items-center justify-center rounded-lg shadow-sm">
                <span id="minutes" class="text-3xl md:text-5xl font-bold text-[#c62828]">00</span>
                <span class="text-xs md:text-sm uppercase text-gray-600 mt-1 font-bold">Min</span>
            </div>
            <div class="countdown-box w-20 h-24 md:w-32 md:h-36 flex flex-col items-center justify-center rounded-lg shadow-sm">
                <span id="seconds" class="text-3xl md:text-5xl font-bold text-[#c62828]">00</span>
                <span class="text-xs md:text-sm uppercase text-gray-600 mt-1 font-bold">Seg</span>
            </div>
        </div>
    </div>
</section>

<!-- DETALLES DEL EVENTO - SOLO RECEPCIÓN -->
<section class="py-20 container mx-auto px-4 reveal relative z-20">
    <h2 class="text-4xl md:text-5xl text-center text-[#9e7f7f] mb-12">Dónde & Cuándo</h2>
    
    <!-- Tarjeta Recepción (Centrada) -->
    <div class="flex justify-center max-w-5xl mx-auto">
        <div class="w-full md:w-2/3 lg:w-1/2 bg-white/90 p-8 rounded-xl shadow-lg text-center border-t-4 border-[#c5a059]">
            <div class="w-16 h-16 bg-[#fffcf5] rounded-full flex items-center justify-center mx-auto mb-4 text-[#c5a059]">
                <i class="fas fa-glass-cheers text-2xl"></i>
            </div>
            <h3 class="text-2xl font-bold mb-2 text-gray-700">Recepción & Fiesta</h3>
            <p class="text-gray-500 mb-1">24 de Diciembre, 2025</p>
            <p class="text-gray-500 mb-4">7:00 PM</p>
            
            <!-- Dirección Actualizada -->
            <p class="font-semibold text-lg mb-2">Quinta Guérico</p>
            <p class="text-sm text-gray-600 mb-6">Urb. Colinas de Bello Monte No. 0-48, detrás del CC Los Naranjos</p>
            
            <!-- Enlace de Google Maps Actualizado -->
            <a href="https://maps.app.goo.gl/1qHMdqEQ2iDSxuqcA" target="_blank" class="inline-block px-6 py-2 border border-[#c5a059] text-[#c5a059] rounded-full hover:bg-[#c5a059] hover:text-white transition duration-300">
                <i class="fas fa-route mr-2"></i>Ir a Ubicación
            </a>
        </div>
    </div>
</section>

<!-- GALERÍA -->
<section class="py-20 bg-white container mx-auto reveal relative z-20 shadow-xl rounded-3xl my-12 px-8">
    <div class="">
        <h2 class="text-4xl md:text-5xl text-center text-[#9e7f7f] mb-4">Momentos Especiales</h2>
        <div class="divider-custom mb-12"></div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 auto-rows-[200px]">
            <!-- FOTO 1 - Enlace de Google Drive -->
            <div class="gallery-item col-span-2 row-span-2">
                <img src="https://drive.google.com/uc?export=view&id=1COQF5V3s_HjTFz7ERrR2Ce5v7HKQ4Kz9" alt="Foto principal de Anthonella">
            </div>
            <!-- FOTO 2 - Enlace de Google Drive -->
            <div class="gallery-item col-span-1 row-span-1">
                <img src="https://drive.google.com/uc?export=view&id=1IFMcL32Z47pSunvgYUZmbY-vevUOBNpM" alt="Foto de Anthonella 2">
            </div>
            <!-- Fotos placeholder de Unsplash -->
            <div class="gallery-item col-span-1 row-span-2">
                <img src="https://images.unsplash.com/photo-1566737236500-c8ac43014a67?q=80&w=400&auto=format&fit=crop" alt="Foto de una persona sonriendo">
            </div>
            <div class="gallery-item col-span-1 row-span-1">
                <img src="https://images.unsplash.com/photo-1529634806980-85c3dd6d34ac?q=80&w=400&auto=format&fit=crop" alt="Arreglo floral rosa">
            </div>
            <div class="gallery-item col-span-2 row-span-1">
                <img src="https://images.unsplash.com/photo-1469334031218-e382a71b716b?q=80&w=800&auto=format&fit=crop" alt="Mujer elegante">
            </div>
        </div>
    </div>
</section>

<!-- CONFIRMACIÓN / RSVP -->
<section class="py-24 relative overflow-hidden text-center reveal z-20 mt-12">
    <div class="absolute inset-0 z-0">
        <!-- Fondo de flores rojas -->
        <img src="https://images.unsplash.com/photo-1558584673-c834fb1cc3ca?q=80&w=2000&auto=format&fit=crop" class="w-full h-full object-cover opacity-30" alt="Fondo de Flores Rojas">
        <div class="absolute inset-0 bg-pink-100/40 mix-blend-overlay"></div>
    </div>
    
    <div class="relative z-10 px-4">
        <h2 class="text-4xl md:text-6xl text-[#c62828] mb-6 script-font">Confirmación de Asistencia</h2>
        <p class="text-lg text-gray-700 font-medium mb-8 max-w-lg mx-auto shadow-sm p-4 bg-white/50 rounded-lg backdrop-blur-md">
            Tu presencia es el mejor regalo. Por favor confirma tu asistencia antes del 10 de Diciembre.
        </p>
        
        <a id="whatsapp-btn" href="#" target="_blank" class="inline-flex items-center gap-3 bg-[#25D366] text-white px-8 py-4 rounded-full text-lg font-bold shadow-lg hover:bg-[#1fb355] hover:scale-105 transition duration-300 border-2 border-white">
            <i class="fab fa-whatsapp text-2xl"></i>
            Confirmar por WhatsApp
        </a>

        <!-- Sección de Regalos -->
        <div class="mt-16 bg-white/85 backdrop-blur-md p-8 rounded-xl inline-block shadow-md max-w-md border border-pink-200">
            <i class="fas fa-gift text-3xl text-[#c62828] mb-4"></i>
            <h3 class="text-xl font-bold mb-2 text-gray-800">Lluvia de Sobres</h3>
            <p class="text-sm text-gray-600">
                Si deseas tener un detalle conmigo, podrás depositarlo en el cofre de lluvia de sobres ubicado en la entrada del salón.
            </p>
        </div>
        
        <!-- Generador de Mensajes con Gemini -->
        <div class="mt-20 bg-white/85 backdrop-blur-md p-8 rounded-xl shadow-xl max-w-lg mx-auto border-t-4 border-[#c5a059]">
            <h3 class="text-2xl font-bold mb-4 text-[#9e7f7f] flex items-center justify-center">
                <i class="fas fa-magic mr-3 text-[#c5a059]"></i>
                Generador de Mensajes ✨
            </h3>
            <p class="text-sm text-gray-600 mb-4">
                ¿Necesitas inspiración? Describe tu relación con Anthonella y el tono que deseas para tu dedicatoria.
            </p>

            <textarea id="messagePrompt" rows="3" class="w-full p-3 border border-pink-300 rounded-lg focus:ring-red-300 focus:border-red-300 transition duration-150" placeholder="Ej: Soy su tío, quiero un mensaje formal y lleno de orgullo."></textarea>
            
            <button onclick="generateMessage()" id="generateBtn" class="w-full mt-4 bg-[#c62828] text-white py-3 rounded-full font-bold shadow-md hover:bg-[#a32222] transition duration-300 disabled:opacity-50">
                <i class="fas fa-feather-alt mr-2"></i>
                Generar Mensaje para el Libro
            </button>

            <div id="messageResult" class="mt-6 text-left border-l-4 border-[#c5a059] pl-4 py-2 bg-pink-50/50 rounded-r-lg min-h-[50px] flex items-center justify-center" style="display: none;">
                <p id="resultText" class="italic text-gray-700"></p>
                <p id="loadingIndicator" class="text-gray-500 hidden"><i class="fas fa-spinner fa-spin mr-2"></i>Generando inspiración...</p>
            </div>
            
            <!-- Botón para copiar el mensaje generado -->
            <button onclick="copyMessage()" id="copyBtn" class="w-full mt-3 bg-[#c5a059] text-white py-2 rounded-full font-semibold shadow-sm hover:bg-opacity-90 transition duration-300 hidden">
                <i class="fas fa-copy mr-2"></i>Copiar Mensaje
            </button>
        </div>
        <!-- FIN NUEVO GENERADOR -->
    </div>
</section>

<footer class="bg-[#c62828] text-white py-8 text-center relative z-20">
    <p class="font-light tracking-wider script-font text-2xl">Anthonella Afanador - Mis 15 Años</p>
    <p class="text-xs opacity-70 mt-2">© 2024</p>
</footer>

<script>
    // --- 1. CONFIGURACIÓN DEL USUARIO (EDITAR AQUÍ) ---
    // Fecha y hora del evento: Diciembre 24, 2025, 7:00 PM (19:00:00)
    const eventDate = new Date("December 24, 2025 19:00:00").getTime();
    const phoneNumber = "573001234567"; // Número de WhatsApp para confirmar asistencia
    
    // Configurar enlace de WhatsApp
    const waBtn = document.getElementById('whatsapp-btn');
    const message = `¡Hola! Quiero confirmar mi asistencia a los 15 años de Anthonella Afanador.`;
    waBtn.href = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

    // --- 2. LOGICA DE AUDIO ---
    const audio = document.getElementById("bgMusic");
    const musicIcon = document.getElementById("musicIcon");
    const musicBtn = document.querySelector('.music-control');
    let isPlaying = false;

    function toggleMusic() {
        if (isPlaying) {
            audio.pause();
            musicIcon.classList.remove("fa-pause");
            musicIcon.classList.add("fa-play");
            musicBtn.classList.remove("music-rotating");
        } else {
            // Intenta reproducir el audio. Esto requiere una interacción del usuario.
            audio.play().then(() => {
                musicIcon.classList.remove("fa-play");
                musicIcon.classList.add("fa-pause");
                musicBtn.classList.add("music-rotating");
            }).catch(e => {
                console.error("Error al intentar reproducir audio automáticamente:", e);
            });
        }
        isPlaying = !isPlaying;
    }

    // --- 3. CUENTA REGRESIVA ---
    const timer = setInterval(function() {
        const now = new Date().getTime();
        const distance = eventDate - now;

        // Cálculo de días, horas, minutos y segundos
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Actualizar la interfaz, añadiendo un cero inicial si es necesario
        document.getElementById("days").innerText = days < 10 ? "0" + days : days;
        document.getElementById("hours").innerText = hours < 10 ? "0" + hours : hours;
        document.getElementById("minutes").innerText = minutes < 10 ? "0" + minutes : minutes;
        document.getElementById("seconds").innerText = seconds < 10 ? "0" + seconds : seconds;

        if (distance < 0) {
            clearInterval(timer);
            document.getElementById("countdown").innerHTML = "<div class='text-2xl font-bold text-[#c62828]'>¡Hoy es el gran día!</div>";
        }
    }, 1000);

    // --- 4. ANIMACIÓN AL HACER SCROLL (Reveal) ---
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('active');
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    // --- 5. GENERADOR DE PARTÍCULAS (EFECTO FLOTANTE) ---
    function createParticles() {
        const container = document.getElementById('particles-container');
        const particleCount = 20;

        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            
            // Tamaño y posición aleatorios
            const size = Math.random() * 10 + 5 + 'px';
            particle.style.width = size;
            particle.style.height = size;
            particle.style.left = Math.random() * 100 + 'vw';
            
            // Duración y retraso de animación aleatorios
            particle.style.animationDuration = Math.random() * 10 + 10 + 's';
            particle.style.animationDelay = Math.random() * 5 + 's';
            
            container.appendChild(particle);
        }
    }
    
    createParticles();

    // --- 6. INTEGRACIÓN GEMINI API (Generador de Mensajes) ---
    const apiKey = ""; // La clave API será proporcionada por el entorno de Canvas
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

    const generateBtn = document.getElementById('generateBtn');
    const messagePrompt = document.getElementById('messagePrompt');
    const messageResultDiv = document.getElementById('messageResult');
    const resultText = document.getElementById('resultText');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const copyBtn = document.getElementById('copyBtn');

    // Función de utilidad para manejar reintentos de la API (Exponential Backoff)
    async function exponentialBackoffFetch(url, options, maxRetries = 5) {
        for (let i = 0; i < maxRetries; i++) {
            try {
                const response = await fetch(url, options);
                if (response.status !== 429) { // 429 is Too Many Requests
                    return response;
                }
                // Si es 429, espera y reintenta
                await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
            } catch (error) {
                console.error("Fetch error on retry:", error);
                if (i === maxRetries - 1) throw error;
                await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
            }
        }
        throw new Error("API call failed after multiple retries.");
    }


    async function generateMessage() {
        const prompt = messagePrompt.value.trim();
        if (!prompt) {
            resultText.innerHTML = "¡Por favor, describe tu relación y el tono deseado para el mensaje!";
            messageResultDiv.style.display = 'flex';
            copyBtn.classList.add('hidden');
            return;
        }

        // Mostrar estado de carga
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Generando...';
        messageResultDiv.style.display = 'flex';
        resultText.textContent = '';
        loadingIndicator.classList.remove('hidden');
        copyBtn.classList.add('hidden');

        const systemPrompt = "Eres un escritor creativo y experto en ceremonias. Tu objetivo es ayudar a los invitados a la fiesta de 15 años de Anthonella Afanador a redactar un mensaje sincero, elegante y apropiado para su libro de recuerdos o tarjeta de felicitación. La respuesta debe ser directamente el mensaje, sin saludos iniciales (como 'Aquí está tu mensaje') ni explicaciones. Debe sonar personal y emotivo.";
        
        const userQuery = `Redacta un mensaje de felicitación para Anthonella por sus 15 años, basado en esta descripción: "${prompt}".`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        try {
            const response = await exponentialBackoffFetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

            if (text) {
                resultText.textContent = text;
                messageResultDiv.style.display = 'flex';
                copyBtn.classList.remove('hidden');
            } else {
                resultText.textContent = "Lo siento, no pude generar el mensaje. Intenta ser más específico.";
                messageResultDiv.style.display = 'flex';
            }

        } catch (error) {
            console.error("Error al llamar a la API de Gemini:", error);
            resultText.textContent = "Ocurrió un error de conexión. Inténtalo de nuevo más tarde.";
            messageResultDiv.style.display = 'flex';
        } finally {
            // Ocultar estado de carga
            generateBtn.disabled = false;
            generateBtn.innerHTML = '<i class="fas fa-feather-alt mr-2"></i> Generar Mensaje para el Libro';
            loadingIndicator.classList.add('hidden');
        }
    }
    
    // Función para copiar el mensaje generado al portapapeles
    function copyMessage() {
        const textToCopy = resultText.textContent;
        if (textToCopy) {
            // Usar document.execCommand('copy') como fallback para iFrames
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            try {
                const successful = document.execCommand('copy');
                const msg = successful ? '¡Copiado!' : 'Error al copiar.';
                // Mostrar un mensaje temporal en el botón
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = `<i class="fas fa-check mr-2"></i> ${msg}`;
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                }, 2000);
            } catch (err) {
                console.error('Error al intentar copiar:', err);
            }
            document.body.removeChild(tempTextArea);
        }
    }
</script>


</body>
</html>
